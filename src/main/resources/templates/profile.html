<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil Saya - Blue Swan Coffee</title>

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4a6fa5',
                        bg: '#d9c6b0',
                        'primary-dark': '#355a8c',
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        .glass-nav {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .nav-link {
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: #4a6fa5;
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }
    </style>
</head>

<body
    class="bg-bg text-[#1a1a1a] font-sans selection:bg-primary selection:text-white min-h-screen flex flex-col relative overflow-x-hidden">

    <!-- Background Elements -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-[-1]">
        <div
            class="absolute bg-primary w-[500px] h-[500px] rounded-full top-[-10%] right-[-10%] opacity-20 filter blur-[80px]">
        </div>
        <div
            class="absolute bg-white w-[300px] h-[300px] rounded-full bottom-[10%] left-[-5%] opacity-30 filter blur-[60px]">
        </div>
    </div>

    <!-- Floating Navbar -->
    <div class="fixed w-full z-50 px-4 mt-6">
        <nav class="max-w-7xl mx-auto glass-nav rounded-2xl flex justify-between items-center px-8 py-4">
            <a th:href="@{/}" class="text-2xl font-bold text-primary italic tracking-tight">Blue Swan <span
                    class="text-[#1a1a1a]">Coffee.</span></a>

            <div class="hidden lg:flex items-center gap-8">
                <a th:href="@{/}"
                    class="nav-link text-[#1a1a1a] font-medium hover:text-primary transition-colors">Home</a>
                <a href="/#about"
                    class="nav-link text-[#1a1a1a] font-medium hover:text-primary transition-colors">About</a>
                <a th:href="@{/menu}"
                    class="nav-link text-[#1a1a1a] font-medium hover:text-primary transition-colors">Menu</a>
                <a href="/#contact"
                    class="nav-link text-[#1a1a1a] font-medium hover:text-primary transition-colors">Contact</a>
            </div>

            <div class="flex items-center gap-4">
                <a th:href="@{/cart}" class="p-2 rounded-full hover:bg-white/50 transition-all text-primary relative">
                    <i data-feather="shopping-cart" class="w-5 h-5"></i>
                    <span th:if="${cart != null && !cart.items.empty}"
                        class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border border-white"></span>
                </a>

                <a th:if="${session.user != null}" th:href="@{/profile}"
                    class="p-2 rounded-full bg-primary/10 text-primary hover:bg-primary hover:text-white transition-all shadow-sm relative"
                    title="Profil Saya">
                    <i data-feather="user" class="w-5 h-5"></i>
                    <span th:if="${hasUnpaidOrder}"
                        class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border border-white"></span>
                </a>

                <a th:if="${session.user == null}" th:href="@{/login}"
                    class="hidden lg:inline-block px-6 py-2 bg-primary text-white rounded-full font-semibold shadow-lg hover:shadow-xl hover:bg-primary-dark transition-all transform hover:-translate-y-0.5">Login</a>
                <a th:if="${session.user != null}" th:href="@{/logout}"
                    class="hidden lg:inline-block px-6 py-2 border-2 border-red-500 text-red-500 rounded-full font-semibold hover:bg-red-500 hover:text-white transition-all">Logout</a>

                <button id="hamburger-menu" class="lg:hidden p-2 text-[#1a1a1a]"><i data-feather="menu"></i></button>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <main class="flex-grow pt-32 pb-20 px-4">
        <div class="max-w-5xl mx-auto">

            <h1 class="text-4xl font-extrabold mb-8 text-center">My <span class="text-primary italic">Profile</span>
            </h1>

            <!-- User Info Card -->
            <div class="glass-card rounded-3xl p-8 mb-8 flex flex-col md:flex-row items-center gap-6">
                <div class="w-24 h-24 bg-primary/20 rounded-full flex items-center justify-center text-primary">
                    <i data-feather="user" class="w-10 h-10"></i>
                </div>
                <div class="text-center md:text-left">
                    <h2 class="text-2xl font-bold" th:text="${session.user.name}">Username</h2>
                    <p class="text-gray-600" th:text="${session.user.email}">user@example.com</p>
                    <span
                        class="inline-block mt-2 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold tracking-wide">MEMBER</span>
                </div>
            </div>

            <!-- Pesan Alert -->
            <div th:if="${message}" th:class="${'alert ' + alertClass + ' mb-6 p-4 rounded-xl shadow-sm border-l-4'}"
                role="alert">
                <strong th:text="${message}"></strong>
            </div>

            <!-- Riwayat Pesanan Table -->
            <div class="glass-card rounded-3xl p-8 overflow-hidden">
                <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <i data-feather="clock" class="w-5 h-5 text-primary"></i> Order History
                </h3>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-gray-500 border-b border-gray-300/50">
                                <th class="py-3 px-4 font-medium">Order ID</th>
                                <th class="py-3 px-4 font-medium">Date</th>
                                <th class="py-3 px-4 font-medium">Total</th>
                                <th class="py-3 px-4 font-medium">Status</th>
                                <th class="py-3 px-4 font-medium text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr th:each="order : ${orders}"
                                class="hover:bg-white/30 transition-colors border-b border-gray-100 last:border-0">
                                <!-- Safe UUID Short Display -->
                                <td class="py-4 px-4 font-mono text-gray-600"
                                    th:text="${'#' + (order.id != null ? #strings.substring(order.id.toString(),0,8) : '???')}">
                                    #ORD-123</td>
                                <td class="py-4 px-4"
                                    th:text="${#temporals.format(order.createdAt, 'dd MMM yyyy HH:mm')}">Oct 20, 2023
                                </td>
                                <td class="py-4 px-4 font-bold text-primary" th:text="'IDR ' + ${order.totalAmount}">IDR
                                    50.000</td>
                                <td class="py-4 px-4">
                                    <span th:if="${order.status.name() == 'PAID'}"
                                        class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">PAID</span>
                                    <span th:if="${order.status.name() == 'CANCELED'}"
                                        class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold">CANCELED</span>
                                    <span th:if="${order.status.name() == 'CREATED'}"
                                        class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">PENDING</span>
                                </td>
                                <td class="py-4 px-4 text-right flex justify-end gap-2">
                                    <!-- PAY BUTTON for PENDING -->
                                    <a th:if="${order.status.name() == 'CREATED'}"
                                        th:href="@{/payment/{id}(id=${order.id})}"
                                        class="inline-block px-4 py-2 bg-primary text-white font-bold rounded-lg shadow-sm hover:shadow-md hover:bg-primary-dark transition-all text-xs">
                                        PAY
                                    </a>
                                    <!-- DETAILS BUTTON for ALL -->
                                    <a th:href="@{/orders/{id}/details(id=${order.id})}"
                                        class="inline-block px-4 py-2 bg-gray-200 text-gray-600 font-bold rounded-lg hover:bg-gray-300 transition-all text-xs">
                                        DETAILS
                                    </a>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(orders)}">
                                <td colspan="5" class="py-8 text-center text-gray-500">No order history found.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- Scripts -->
    <script>
        feather.replace();
    </script>
</body>

</html>